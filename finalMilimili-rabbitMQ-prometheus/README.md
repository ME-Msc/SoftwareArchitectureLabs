# SA-Final-Milimili
模拟典型的互联网视频系统，实现视频上传、转码、播放的spring项目

## 项目说明

### 功能性要求
1. 实现独立的一个前端应用让用户上传视频文件；  
2. 用户上传的原始视频文件保存在独立的存储系统（例如网络文件系统NFS、分布式文件系统glusterfs等）；  
3. 存储完成后，创建一个任务，放入消息队列（消息体包含刚保存的原始视频文件信息，消息队列可食用rabbitmq或kafka等）；  
4. 实现一个独立的编码子系统，负责从消息队列中取出任务，启动一个编码器（handbreak）执行编码，转为至少两种分辨率（360p，720p，1080p等）；  
5. 编码结束后将输出的视频文件保存在存储系统中；  
6. 实现独立的一个前端应用让用户播放视频，每次播放连接到视频系统打开文件进行播放。

### 非功能性要求
1. 为支持用户并发访问，两个前端应用子系统（上传、播放）应可扩展。请在系统中自行加入负载均衡器（如haproxy等）和监控组件（如prometheus等）进行性能指标监控，在指标低于某个阈值时触发警报自动进行子系统扩展，或给出提示信息让管理人员手工进行子系统扩展；  
2. 为提高系统响应性，编码子系统应在有限条件下进行水平扩展。因编码任务是计算密集型任务，假设系统资源只够N个编码任务同时运行，因此上述系统中设计了任务队列，用于缓冲待编码任务。如果当前编码任务数小于N，且任务队列中存在等待任务，则直接启动新的编码进程处理任务，否则让任务处于等待。请在编码子系统中设法实现这一扩展规则。

## 文件说明
1. `configFiles` : 项目外其他组件的配置文件
    1. `alertmanager`: 邮件警报
    2. `gatling`: 压力测试
    3. `haproxy`: 水平扩展
    4. `prometheus`: 性能监控
2. `data`: 保存测试视频文件的目录，`raw`中是用户上传的原始视频，`360/720/1080`分别是各分辨率转码后的文件
3. `gatlingResults`: 压力测试的结果，包含了cmd的截图和gatling原始报告，针对了单容器和四容器运行的情况
4. `milimili-encoder`: 独立的视频编码系统，从rabbitMQ消息队列中读取消息，通过流量控制实现了限制N个编码任务同时运行。
5. `milimili-player`: 使用vue的视频播放前端
6. `milimili-server`: 处理http请求的后端
7. `milimili-upload`: 使用vue的视频上传前端，上传成功后向rabbitMQ发送消息缓存
